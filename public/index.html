<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Settings Modal</title>
    <script>
      window.updateActiveSettings = function(state) {
        let result = state.length != 0 ? 'Settings in sessionStorage:<br />' : '';
        state.map(x => result += x + '<br />');
        document.getElementById('active-settings').innerHTML = result;
      }
      window.addEventListener('load', function() {
        const settingsInStore = window.sessionStorage.getItem(window.settingsModalConstants.sessionStorageKey);
        console.log(`Settings in sessionStorage: ${settingsInStore}`);
        const parsedState = JSON.parse(settingsInStore);
        window.updateActiveSettings(settingsInStore ? Object.keys(parsedState).map(x => `${x} = ${parsedState[x]}`) : ['Settings will be displayed here if present'])
      });
      window.loadSettingsModal = async function (elementId) {
        if (!RenderSettingsModal) {
          throw new Error('Missing SettingsModal.js');
        }
        RenderSettingsModal(elementId);
        await window.messagePublisherInstance.subscribe('settingsUpdated', function(state) {
          console.log(state);
          window.updateActiveSettings(Object.keys(state).map(x => `${x}:${state[x]}`));
        });
      };
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <button onclick="loadSettingsModal('root')">Render modal</button>
    <div id="root"></div>
    <div id="separator">Everything below this point is not a part of the React component</div>
    <div id="active-settings"></div>
  </body>
</html>
